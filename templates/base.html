<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Bio Aflora Brasil - Erva-Mate Premium e Sustentável{% endblock %}</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block meta_description %}Bio Aflora Brasil - Especializada em produtos de erva-mate premium (Ilex paraguariensis), unindo tradição, qualidade e sustentabilidade na proteção da erva-mate nativa.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}erva-mate, chimarrão, chá-mate, Ilex paraguariensis, sustentabilidade, orgânico, Brasil, mate premium, erva natural{% endblock %}">
    <meta name="author" content="Bio Aflora Brasil">
    <meta name="robots" content="index, follow">
    <meta name="language" content="pt-BR">
    <meta name="theme-color" content="#10b981">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.url.replace(request.host_url.rstrip('/'), 'https://bioaflora.com.br') }}">
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.meta_description() }}{% endblock %}">
    <meta property="og:image" content="https://bioaflora.com.br{{ url_for('static', filename='images/og-image.jpg') }}">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:site_name" content="Agronanobio - Projeto Bio Aflora">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.url.replace(request.host_url.rstrip('/'), 'https://bioaflora.com.br') }}">
    <meta property="twitter:title" content="{% block twitter_title %}{{ self.title() }}{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}{{ self.meta_description() }}{% endblock %}">
    <meta property="twitter:image" content="https://bioaflora.com.br{{ url_for('static', filename='images/og-image.jpg') }}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.url.replace(request.host_url.rstrip('/'), 'https://bioaflora.com.br') }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.svg') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/favicon.svg') }}">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','{{ get_env_value("GTM_CONTAINER_ID", "GTM-BIOAFLORA") }}');</script>
    <!-- End Google Tag Manager -->

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ get_env_value('GA4_MEASUREMENT_ID', 'GA4-BIOAFLORA') }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ get_env_value("GA4_MEASUREMENT_ID", "GA4-BIOAFLORA") }}', {
            page_title: document.title,
            page_location: window.location.href,
            custom_map: {
                'custom_parameter_1': 'bio_aflora_source'
            }
        });

        // Enhanced eCommerce tracking setup
        gtag('config', '{{ get_env_value("GA4_MEASUREMENT_ID", "GA4-BIOAFLORA") }}', {
            send_page_view: true,
            anonymize_ip: true,
            allow_google_signals: false,
            cookie_flags: 'SameSite=Strict;Secure'
        });
    </script>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Agronanobio",
        "legalName": "Agronanobio Industria, Comercio, Importação e Exportação Ltda",
        "description": "Especializada em produtos de erva-mate premium sustentáveis - Projeto Bio Aflora",
        "url": "https://bioaflora.com.br",
        "logo": "https://bioaflora.com.br{{ url_for('static', filename='images/favicon.svg') }}",
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+55-42-99957-5280",
            "contactType": "customer service",
            "areaServed": "BR",
            "availableLanguage": "Portuguese"
        },
        "sameAs": [
            "https://www.facebook.com/bioaflora",
            "https://www.instagram.com/bioaflora",
            "https://bioaflora.com.br"
        ],
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "Vicina 11, Linha Esperança, 1954, Serra do Tigre",
            "addressLocality": "Distrito de Dorizon",
            "addressRegion": "Paraná",
            "postalCode": "84570-000",
            "addressCountry": "BR"
        },
        "taxID": "11.743.641/0001-52",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://bioaflora.com.br/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    {% block structured_data %}{% endblock %}
</head>
<body itemscope itemtype="https://schema.org/WebPage">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ get_env_value('GTM_CONTAINER_ID', 'GTM-BIOAFLORA') }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{{ url_for('inicio') }}">
                🌿 Agronanobio
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('inicio') }}">Início</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('saiba_mais') }}">Saiba Mais</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('blog') }}">Blog</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('contato') }}">Contato</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('sobre_nos') }}">Sobre Nós</a>
                    </li>
                </ul>
                
                <!-- Search Form -->
                <form class="d-flex search-form" role="search" id="searchForm">
                    <div class="search-container">
                        <input class="form-control search-input" type="search" placeholder="Buscar..." id="searchInput">
                        <button class="btn search-btn" type="submit">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </nav>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="container mt-3">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block breadcrumbs %}{% endblock %}
        {% block content %}{% endblock %}
    </main>

    <footer class="py-5 mt-5">
        <div class="container">
            <!-- Newsletter Section -->
            <div class="row mb-4">
                <div class="col-lg-8 mx-auto text-center">
                    <div class="newsletter-section">
                        <h4 class="mb-3">🌿 Receba Novidades Sustentáveis</h4>
                        <p class="mb-4">Fique por dentro das novidades sobre erva-mate, sustentabilidade e produtos exclusivos da Bio Aflora Brasil.</p>
                        <form class="newsletter-form" id="newsletterForm">
                            <div class="input-group">
                                <input type="email" class="form-control newsletter-input" 
                                       placeholder="Seu melhor e-mail" 
                                       required id="newsletterEmail">
                                <button class="btn btn-success newsletter-btn" type="submit">
                                    <span class="newsletter-text">Inscrever-se</span>
                                    <span class="newsletter-loading" style="display: none;">
                                        <span class="spinner-border spinner-border-sm" role="status"></span>
                                    </span>
                                </button>
                            </div>
                            <small class="text-muted mt-2 d-block">
                                📧 Respeitamos sua privacidade. Sem spam, apenas conteúdo de qualidade.
                            </small>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Footer Info -->
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5>Agronanobio</h5>
                    <p><strong>Industria, Comercio, Importação e Exportação Ltda</strong><br>
                    Projeto Bio Aflora - Sistema agroflorestal com erva-mate nativa.</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Links Rápidos</h5>
                    <ul class="list-unstyled footer-links">
                        <li><a href="{{ url_for('inicio') }}">Início</a></li>
                        <li><a href="{{ url_for('saiba_mais') }}">Saiba Mais</a></li>
                        <li><a href="{{ url_for('contato') }}">Contato</a></li>
                        <li><a href="{{ url_for('sobre_nos') }}">Sobre Nós</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Contato</h5>
                    <p class="mb-1">📧 contato@bioaflora.com.br</p>
                    <p class="mb-1">📞 (42) 99957-5280</p>
                    <p class="mb-1">📍 Vicina 11, Linha Esperança, 1954</p>
                    <p class="mb-1">Serra do Tigre - Distrito de Dorizon</p>
                    <p class="mb-1">CEP: 84.570-000 - Mallet-PR</p>
                    <p class="small">🏢 CNPJ: 11.743.641/0001-52</p>
                </div>
            </div>
            
            <hr class="my-4">
            
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 Agronanobio Industria, Comercio, Importação e Exportação Ltda. Todos os direitos reservados.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">Desenvolvido com 💚 para um mundo mais sustentável</small>
                </div>
            </div>
            
            <!-- Privacy Notice for Analytics -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="privacy-notice" id="privacyNotice" style="display: none;">
                        <div class="alert alert-info alert-dismissible fade show">
                            <div class="d-flex align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="alert-heading mb-2">🍪 Uso de Cookies e Analytics</h6>
                                    <p class="mb-2">
                                        Utilizamos cookies e ferramentas de análise para melhorar sua experiência, 
                                        personalizar conteúdo e analisar o tráfego do site. Os dados são tratados 
                                        conforme nossa política de privacidade.
                                    </p>
                                    <div class="privacy-buttons">
                                        <button type="button" class="btn btn-success btn-sm me-2" onclick="acceptAnalytics()">
                                            ✅ Aceitar
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="declineAnalytics()">
                                            ❌ Recusar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Floating Button -->
    <div class="whatsapp-float" id="whatsappButton">
        <div class="whatsapp-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.893 3.488"/>
            </svg>
        </div>
        <span class="whatsapp-tooltip">Fale conosco!</span>
    </div>

    <!-- Scroll to Top Button -->
    <div class="scroll-to-top" id="scrollToTop">
        <div class="scroll-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
            </svg>
        </div>
        <span class="scroll-tooltip">Voltar ao topo</span>
    </div>

    <!-- Page Loading Overlay -->
    <div id="pageLoader" class="page-loader">
        <div class="loader-content">
            <div class="mate-spinner">
                <div class="mate-cup">🧉</div>
                <div class="loader-text">Bio Aflora Brasil</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    
    <!-- Analytics Consent Management -->
    <script>
        // Check if user has already made a choice about analytics
        function checkAnalyticsConsent() {
            const consent = localStorage.getItem('analytics_consent');
            
            if (consent === null) {
                // Show privacy notice after 2 seconds
                setTimeout(() => {
                    const privacyNotice = document.getElementById('privacyNotice');
                    if (privacyNotice) {
                        privacyNotice.style.display = 'block';
                    }
                }, 2000);
            } else if (consent === 'accepted') {
                enableAnalytics();
            } else {
                disableAnalytics();
            }
        }
        
        function acceptAnalytics() {
            localStorage.setItem('analytics_consent', 'accepted');
            hidePrivacyNotice();
            enableAnalytics();
            
            // Track consent acceptance
            if (typeof gtag !== 'undefined') {
                gtag('event', 'privacy_consent', {
                    'event_category': 'privacy',
                    'event_label': 'accepted'
                });
            }
        }
        
        function declineAnalytics() {
            localStorage.setItem('analytics_consent', 'declined');
            hidePrivacyNotice();
            disableAnalytics();
            
            // Basic tracking for decline (before disabling)
            if (typeof gtag !== 'undefined') {
                gtag('event', 'privacy_consent', {
                    'event_category': 'privacy',
                    'event_label': 'declined'
                });
            }
        }
        
        function hidePrivacyNotice() {
            const privacyNotice = document.getElementById('privacyNotice');
            if (privacyNotice) {
                privacyNotice.style.display = 'none';
            }
        }
        
        function enableAnalytics() {
            // Enable Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'update', {
                    'analytics_storage': 'granted',
                    'ad_storage': 'denied' // Keep ads disabled for privacy
                });
            }
            
            // Enable Google Tag Manager
            if (typeof dataLayer !== 'undefined') {
                dataLayer.push({
                    'event': 'consent_update',
                    'analytics_consent': 'granted'
                });
            }
        }
        
        function disableAnalytics() {
            // Disable Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'update', {
                    'analytics_storage': 'denied',
                    'ad_storage': 'denied'
                });
            }
            
            // Clear existing analytics cookies
            const cookiesToClear = ['_ga', '_ga_GA4-BIOAFLORA', '_gid', '_gat'];
            cookiesToClear.forEach(cookie => {
                document.cookie = `${cookie}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
                document.cookie = `${cookie}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.bioaflora.com.br;`;
            });
        }
        
        // Initialize consent system on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set default consent to denied
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'default', {
                    'analytics_storage': 'denied',
                    'ad_storage': 'denied',
                    'wait_for_update': 2000
                });
            }
            
            checkAnalyticsConsent();
        });
    </script>
</body>
</html>